name: Fix-release

on:
  workflow_dispatch:
    inputs:
      release-version:
        description: "Release version"
        required: true
        type: number

jobs:
  lint:
    uses: despores/shri-infra-homework/.github/workflows/lint.yml@main

  test:
    uses: despores/shri-infra-homework/.github/workflows/test.yml@main

  fix-release:
    runs-on: ubuntu-latest
    env:
      IMAGE: cr.yandex/${{ secrets.CONTAINER_REGISTRY_ID }}/app
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    steps:

      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.ACCESS_TOKEN }}
          ref: releases/${{ inputs.release-version }}

      - name: Setup git
        run: |
          git config user.name "despores"
          git config user.email "github@noreply.com"